<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ดู มหาศึกล้างพิภพ - NNAsub</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&family=Russo+One&display=swap" rel="stylesheet">
    
    <style>
        /* --- Theme --- */
        :root { --primary-color: #ff3f34; --bg-color: #0f1014; --card-bg: #1e2126; --text-color: #f1f2f6; }
        body { font-family: 'Kanit', sans-serif; background: var(--bg-color); color: var(--text-color); margin: 0; padding: 0; }
        a { text-decoration: none; color: inherit; }

        /* --- Navbar --- */
        nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: rgba(32, 29, 33, 0.95); border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100; }
        .logo { font-family: 'Russo One', sans-serif; font-size: 1.5rem; color: var(--primary-color); }
        .back-btn:hover { color: #fff; }

        /* --- Main Layout --- */
        .watch-container { max-width: 1400px; margin: 20px auto; padding: 0 20px; display: grid; grid-template-columns: 1fr 350px; gap: 20px; }

        /* --- Video Section --- */
        .video-wrapper { 
            background: #000; width: 100%; aspect-ratio: 16/9; 
            border-radius: 5px; overflow: hidden; position: relative; 
            border: 1px solid #333;
        }
        .video-wrapper iframe { width: 100%; height: 100%; border: none; }

        /* --- Server Select (ส่วนเลือกเซิร์ฟเวอร์ เพิ่มใหม่) --- */
        .server-box {
            background: #15171c;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .server-label { color: #aaa; font-size: 0.9rem; }
        .server-btn {
            background: #333;
            color: #ddd;
            border: 1px solid #444;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: 0.2s;
        }
        .server-btn:hover { background: #555; }
        .server-btn.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }

        /* --- ปุ่มรีโหลด --- */
        .reload-bar { text-align: center; margin: 15px 0; }
        .btn-reload {
            background: #ff9103; padding: 8px 20px; border-radius: 5px;
            font-size: 14px; color: #fff; border: none; cursor: pointer;
            transition: 0.2s; display: inline-flex; align-items: center; gap: 5px;
        }
        .btn-reload:hover { background: #ffaa3d; }

        /* --- Anime Details --- */
        .anime-info-box {
            background: var(--card-bg); padding: 20px; border-radius: 8px;
            display: flex; gap: 20px; border: 1px solid #333;
        }
        .poster-img { width: 150px; border-radius: 5px; flex-shrink: 0; }
        .poster-img img { width: 100%; border-radius: 5px; }
        .info-text h1 { margin: 0 0 10px; color: var(--primary-color); font-size: 1.6rem; }
        .tag-line { margin-bottom: 10px; font-size: 0.9rem; color: #aaa; }
        .tag-line span { color: #fff; margin-right: 5px; }
        .synopsis { font-size: 0.95rem; line-height: 1.6; color: #ddd; }

        /* --- Sidebar --- */
        .episode-sidebar { background: var(--card-bg); border-radius: 8px; border: 1px solid #333; display: flex; flex-direction: column; height: fit-content; max-height: 800px; }
        .sidebar-header { padding: 15px; border-bottom: 1px solid #333; font-weight: bold; background: rgba(0,0,0,0.2); border-radius: 8px 8px 0 0; }
        .ep-list { max-height: 500px; overflow-y: auto; padding: 10px; }
        .ep-btn { 
            display: block; width: 100%; padding: 10px 15px; margin-bottom: 5px; 
            background: #2f3640; color: #ddd; border: none; border-radius: 4px; 
            text-align: left; cursor: pointer; font-family: 'Kanit';
        }
        .ep-btn:hover { background: #3d4652; color: #fff; }
        .ep-btn.active { background: var(--primary-color); color: #fff; font-weight: bold; }

        @media (max-width: 900px) { 
            .watch-container { grid-template-columns: 1fr; } 
            .anime-info-box { flex-direction: column; }
            .poster-img { width: 100px; margin: 0 auto; }
        }
    </style>
</head>
<body>

    <nav>
        <a href="../index.html" class="logo">NNAsub</a>
        <a href="../index.html" class="back-btn" style="color:#aaa;">❮ กลับหน้าหลัก</a>
    </nav>

    <div class="watch-container">
        <div class="main-content">
            
            <div class="video-wrapper" id="videoPlayer">
                <div style="display:flex; justify-content:center; align-items:center; height:100%; color:#555;">
                    <p>กรุณาเลือกตอนด้านขวา</p>
                </div>
            </div>

            <div class="server-box" id="serverOptions" style="display:none;">
                <span class="server-label">เลือกเซิร์ฟเวอร์:</span>
                <div id="serverBtns" style="display:flex; gap:10px;"></div>
            </div>

            <div class="reload-bar">
                <button class="btn-reload" onclick="reloadVideo()">
                    ↻ ตัวเล่นไม่โหลดคลิกที่นี่
                </button>
            </div>

            <div class="anime-info-box">
                <div class="poster-img">
                    <img src="../images/TLK.jpg" onerror="this.src='https://via.placeholder.com/150x200'">
                </div>
                <div class="info-text">
                    <h1>มหาศึกล้างพิภพ</h1>
                    <div class="tag-line">
                        <span>Swallowedstar</span> | <span>ซับไทย</span>
                    </div>
                    <div class="synopsis"></div>
                </div>
            </div>

        </div>

        <div class="episode-sidebar">
            <div class="sidebar-header">รายการตอน</div>
            <div class="ep-list" id="epListContainer"></div>
        </div>
    </div>

    <script>
        // --- 1. ปรับโครงสร้างข้อมูล (ใส่หลายเซิร์ฟเวอร์ตรงนี้) ---
        const episodes = [
            { 
                name: "ตอนที่ 205", 
                servers: {
                    //"ตัวเล่นหลัก (ดูลื่นๆหัวแตก)": "",
                    "สำรอง 1 (ดูชัดแต่มีโฆษณา)": "https://ok.ru/videoembed/10774841526792?nochat=1",
                }
            },
            { 
                name: "ตอนที่ 206 ", 
                servers: {
                    "ตัวเล่นหลัก (ดูลื่นๆหัวแตก) ": "https://drive.google.com/file/d/1kDxU1NLqEBPdywzXrjAeJLcWwjjmo31z/preview",
                    "สำรอง 1 (ดูชัดแต่มีโฆษณา)": "https://ok.ru/videoembed/10866740234760?nochat=1",
                    
                }
            },
            { 
                name: "ตอนที่ 207 ยังไม่ได้อัพ", 
                servers: {
                    "ตัวเล่นหลัก (ดูลื่นๆหัวแตก) ": "",
                    "สำรอง 1 (ดูชัดแต่มีโฆษณา)": "",
                } 
            }
        ];

        const listEl = document.getElementById('epListContainer');
        const player = document.getElementById('videoPlayer');
        const serverOptions = document.getElementById('serverOptions');
        const serverBtns = document.getElementById('serverBtns');

        // ฟังก์ชัน 1: โหลดข้อมูลตอน (สร้างปุ่มเซิร์ฟเวอร์)
        function selectEpisode(epIndex, btnEl) {
            const ep = episodes[epIndex];
            
            // เปลี่ยนสีปุ่มตอน
            document.querySelectorAll('.ep-btn').forEach(b => b.classList.remove('active'));
            if(btnEl) btnEl.classList.add('active');

            // เคลียร์ปุ่มเซิร์ฟเวอร์เก่า
            serverBtns.innerHTML = '';
            let hasServer = false;
            let firstServerSrc = null;

            // วนลูปสร้างปุ่มเซิร์ฟเวอร์
            for (const [serverName, src] of Object.entries(ep.servers)) {
                if(src) { // สร้างปุ่มเฉพาะที่มีลิงก์
                    hasServer = true;
                    const sBtn = document.createElement('button');
                    sBtn.className = 'server-btn';
                    sBtn.innerText = serverName;
                    sBtn.onclick = function() { changeServer(src, this); };
                    serverBtns.appendChild(sBtn);

                    // เก็บลิงก์แรกไว้เล่นอัตโนมัติ
                    if(!firstServerSrc) firstServerSrc = { src: src, btn: sBtn };
                }
            }

            if (hasServer) {
                serverOptions.style.display = 'flex';
                // เล่นเซิร์ฟเวอร์แรกทันที
                changeServer(firstServerSrc.src, firstServerSrc.btn);
            } else {
                serverOptions.style.display = 'none';
                player.innerHTML = `<div style="display:flex; justify-content:center; align-items:center; height:100%; color:#555;"><p>ตอนนี้ยังไม่พร้อมรับชมครับ</p></div>`;
                alert("ตอนนี้ยังไม่พร้อมรับชมครับ");
            }
        }

        // ฟังก์ชัน 2: เปลี่ยนหน้าจอ Video (เมื่อกดปุ่มเซิร์ฟเวอร์)
        function changeServer(src, btnEl) {
           player.innerHTML = `<iframe 
            id="mainFrame" 
            src="${src}" 
            width="100%" 
            height="100%" 
            frameborder="0" 
            scrolling="no" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" 
            allowfullscreen 
            style="border:none;"></iframe>`;
            
            // เปลี่ยนสีปุ่มเซิร์ฟเวอร์
            document.querySelectorAll('.server-btn').forEach(b => b.classList.remove('active'));
            if(btnEl) btnEl.classList.add('active');
        }

        // ฟังก์ชันปุ่มรีโหลด
        function reloadVideo() {
            const iframe = document.getElementById('mainFrame');
            if(iframe) {
                iframe.src = iframe.src;
            } else {
                alert("กรุณาเลือกตอนก่อนครับ");
            }
        }

        // สร้างรายการปุ่มตอนทั้งหมด (เมนูขวา)
        episodes.forEach((ep, index) => {
            const btn = document.createElement('button');
            btn.className = 'ep-btn';
            btn.innerText = ep.name;
            btn.onclick = function() { selectEpisode(index, this); };
            listEl.appendChild(btn);
        });

        // --- ส่วนตรวจสอบลิงก์เพื่อเลือกตอนอัตโนมัติ ---
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            let epIndex = urlParams.get('ep'); 

            if (!epIndex || isNaN(epIndex)) epIndex = 0;
            else epIndex = parseInt(epIndex);

            if (epIndex >= 0 && epIndex < episodes.length) {
                const targetBtn = listEl.children[epIndex];
                selectEpisode(epIndex, targetBtn);
            }
        };

    </script>
</body>
</html>